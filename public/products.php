<?php

require_once '../includes/check_maintenance.php';
?>
<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Primary -->
    <meta name="title" content="A.S UNLOCK" />
    <meta name="description"
        content="A.S UNLOCK - خبراء فتح وإصلاح أجهزة التابلت بأحدث التقنيات. خدمات سريعة ومضمونة مع دعم على مدار الساعة." />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://as_unlock.ct.ws" />
    <meta property="og:title" content="A.S UNLOCK" />
    <meta property="og:description"
        content="A.S UNLOCK - خبراء فتح وإصلاح أجهزة التابلت بأحدث التقنيات. خدمات سريعة ومضمونة مع دعم على مدار الساعة." />
    <meta property="og:image" content="https://as_unlock.ct.ws/" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://as_unlock.ct.ws/assets/image/favicon.ico" />
    <meta property="twitter:title" content="A.S UNLOCK" />
    <meta property="twitter:description"
        content="A.S UNLOCK - خبراء فتح وإصلاح أجهزة التابلت بأحدث التقنيات. خدمات سريعة ومضمونة مع دعم على مدار الساعة." />
    <meta property="twitter:image" content="https://as_unlock.ct.ws/assets/image/favicon.ico" />

    <!-- Links -->
    <link rel="icon" type="image/x-icon" href="../assets/image/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap"rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/products.css">
    <link rel="stylesheet" href="../assets/css/dark-mode-index.css">

    <title>A.S UNLOCK - Products</title>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="../assets/image/favicon.ico" alt="Not Found Logo" loading="eager">
            <h1>A.S UNLOCK</h1>
        </div>
        
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <nav class="navbar" id="navbar">
            <ul class="links">
                <li><a href="index.php">الرئيسية</a></li>
                <li><a href="#" class="fexid-btn" style="color: #1976D2;">المنتجات</a></li>
                <li><a href="../client/download.php">التحميلات</a></li>
                <li><a href="../client/guarantees.php">الضمان</a></li>
                <li><a href="../team/team.php">فريق العمل</a></li>
            </ul>
            <ul class="btn">
                <li><a href="https://wa.me/201069062005?text=السلام%20عليكم%20ورحمة%20الله%20وبركاته%0Aعاوز%20استفسر%20عن%20" class="contact co-btn" target="_blank">أتصل بنا <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z" /></svg></a></li>
                <li><a href="login.php" class="login lo-btn">تسجيل <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z" /><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" /></svg></a></li>
                <li></li>
                <li class="dark-mode-toggle"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16" /></svg></a></li>
            </ul>
        </nav>
    </header>
    <!-- Section Products -->
    <section class="products-shop-con">
        <div class="container">
            <div class="offic">
                <h1>المنتجات</h1>
                <!-- <p>وصف للمنتجات ... .</p> -->
                <!-- لو انت يا أبو الشافي حابب تضيف الوصف ضيفه انت عشان انا مكسل بصراحة -->
            </div>
            <div class="product-shop">
                <div class="mathar">
                    </div>
                    <div class="con-product">
                        <div class="shorts-prot">
                            <div class="choose-select">
                                <div class="link-select">
                                    <select name="product_filter" id="productFilter" onchange="filterProducts()">
                                        <option value="all">كل المنتجات</option>
                                        <?php
                                        require_once '../includes/config.php';
                                        $stmt = $pdo->query("SELECT DISTINCT service_type FROM digital_products WHERE service_type IS NOT NULL AND service_type != ''");
                                        $serviceTypes = $stmt->fetchAll(PDO::FETCH_ASSOC);
                                        
                                        foreach ($serviceTypes as $type) {
                                            echo '<option value="'.htmlspecialchars($type['service_type']).'"';
                                            if (isset($_GET['service_type']) && $_GET['service_type'] == $type['service_type']) {
                                                echo ' selected';
                                            }
                                            echo '>'.htmlspecialchars($type['service_type']).'</option>';
                                        }
                                        ?>
                                    </select>
                                    <a href="product.php">الباقات المميزة</a>
                                </div>
                                <!-- <div><span><a href="index.html" style="color: #1976D2;"> الرئيسية </a></span>/ <span style="margin: 0 8px 0 0;">المنتجات</span></div> -->
                            </div>
                        </div>
                    </div>
                    <!-- Product -->
                    <div class="show-products">
                        <div class="product">
                            <div class="container">
                                <div class="grid-pr">
                                    <?php
                                    require_once '../includes/config.php';

                                    // بناء استعلام SQL مع التصفية
                                    $sql = "SELECT * FROM digital_products WHERE is_published = 1";
                                    $params = [];

                                    // إذا كان هناك تصفية حسب نوع الخدمة
                                    if (isset($_GET['service_type']) && $_GET['service_type'] != 'all') {
                                        $sql .= " AND service_type = :service_type";
                                        $params[':service_type'] = $_GET['service_type'];
                                    }

                                    $stmt = $pdo->prepare($sql);
                                    $stmt->execute($params);
                                    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);

                                    if (empty($products)) {
                                        // حالة عدم وجود منتجات
                                        ?>
                                        <div class="no-products" style="text-align: center; margin: 50px 0;">
                                            <div style="font-size: 80px; color: #ccc;">
                                                <i class="bi bi-exclamation-circle"></i>
                                            </div>
                                            <h2 style="color: #666; margin-top: 20px;">لا يوجد منتجات متاحة حالياً</h2>
                                            <p style="color: #888;">يرجى التحقق لاحقاً أو الاتصال بنا لمزيد من المعلومات</p>
                                        </div>
                                        <?php
                                    } else {
                                        foreach ($products as $product) {
                                            // تحويل مميزات JSON إلى مصفوفة
                                            $features = json_decode($product['features'], true);
                                            
                                            // حساب السعر بعد الخصم إذا كان هناك خصم
                                            $final_price = $product['discount'] ? ($product['price'] - $product['discount']) : $product['price'];
                                            ?>
                                            
                                            <div class="card-pr">
                                                <div class="top-prod-card">
                                                    <div class="sec-one-pr">
                                                        <div class="img">
                                                            <img src="<?php echo htmlspecialchars($product['image_path']); ?>" alt="<?php echo htmlspecialchars($product['product_name']); ?>" loading="lazy">
                                                        </div>
                                                    </div>
                                                    <div class="sec-two-pr">
                                                        <h3><?php echo htmlspecialchars($product['product_name']); ?></h3>
                                                        <div class="price-pr">
                                                            <?php if ($product['discount'] > 0): ?>
                                                                <span><del><?php echo htmlspecialchars($product['price']); ?> جنية</del></span>
                                                            <?php endif; ?>
                                                            <h1><?php echo htmlspecialchars($final_price); ?> جنية</h1>
                                                        </div>
                                                        <button class="btn-product" onclick="openProductModal(<?php echo $product['id']; ?>)">طلب الخدمة</button>
                                                    </div>
                                                    <div class="check-product">
                                                        <ul class="scll">
                                                            <?php if (!empty($features)): ?>
                                                                <?php foreach ($features as $feature): ?>
                                                                    <li><?php echo htmlspecialchars($feature); ?> <span><i class="bi bi-check-lg"></i></span></li>
                                                                <?php endforeach; ?>
                                                            <?php else: ?>
                                                                <li><span><i class="bi bi-check-lg"></i></span></li>
                                                                <li><span><i class="bi bi-check-lg"></i></span></li>
                                                                <li><span><i class="bi bi-check-lg"></i></span></li>
                                                            <?php endif; ?>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php
                                        }
                                    }
                                    ?>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--  -->
    <!--  -->
    <!--  -->
    <main class="section-bottom">
        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="grid-website">
                    <div class="logo">
                        <img src="../assets/image/favicon.ico" alt="Not Found Icon" loading="lazy">
                        <h1>A.S UNLOCK</h1>
                    </div>
                    <div class="description"><p>خبراء السوفت وير وخدمات التابلت التعليمية والدعم الفني السريع.</p></div>
                </div>
                <div class="quick-links">
                    <ul class="links">
                        <li><a href="index.php">الرئيسية</a></li>
                        <li><a href="#">المنتجات</a></li>
                        <li><a href="../client/download.php">التحميلات</a></li>
                        <li><a href="../client/guarantees.php">الضمان</a></li>
                        <li><a href="../team/team.php">فريق العمل</a></li>
                        <li><a href="https://wa.me/201069062005?text=السلام%20عليكم%20ورحمة%20الله%20وبركاته%0Aعاوز%20استفسر%20عن%20">تواصل معنا</a></li>
                    </ul>
                </div>
                <div class="quick-social">
                    <div class="em-ph">
                        <span>asunlockhelp@gmail.com</span>
                        <span class="span-phone">+20 106 906 2005</span>
                    </div>
                    <ul class="links social-links">
                        <!--  -->
                        <!-- === -->
                        <!--  -->
                    </ul>
                </div>
                <div class="footer-content">
                    <p>© <span id="year"></span> جميع الحقوق محفوظة <span>تم انشاء من قبل <a href="https://mostafamtaha.ct.ws" target="_blank">mostafamtaha</a></span></p>
                </div>
            </div>
        </footer>
    </main>
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title">خطط الخدمة</h2>
            <div class="modal-body">
                <div id="modalPlansContainer" class="plans-container">

                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../assets/js/public_links.js"></script>
    <script src="../assets/js/products.js"></script>
    <script src="../assets/js/dark-mode.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const productSection = document.querySelector('.product');
            
            // إنشاء مراقب متقدم
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const titleProd = entry.target.querySelector('.title-prod');
                        const cards = entry.target.querySelectorAll('.card-pr');
                        
                        // تفعيل تأثير العنوان
                        if (titleProd) {
                            titleProd.querySelector('h1').classList.add('visible');
                            titleProd.querySelector('p').classList.add('visible');
                        }
                        
                        // تفعيل تأثير البطاقات بشكل متدرج
                        cards.forEach((card, index) => {
                            setTimeout(() => {
                                card.classList.add('visible');
                            }, index * 200); // تأخير 200ms بين كل بطاقة
                        });
                        
                        // إيقاف المراقبة بعد التنفيذ لتحسين الأداء
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -100px 0px' // تحميل التأثير قبل 100px من الوصول للقسم
            });

            if (productSection) {
                observer.observe(productSection);
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.getElementById('hamburger');
            const navbar = document.getElementById('navbar');
            
            hamburger.addEventListener('click', function() {
                this.classList.toggle('active');
                navbar.classList.toggle('active');
                
                // منع التمرير عند فتح القائمة
                if (navbar.classList.contains('active')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = 'auto';
                }
            });
            
            // إغلاق القائمة عند النقر على رابط
            const navLinks = document.querySelectorAll('.navbar a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    hamburger.classList.remove('active');
                    navbar.classList.remove('active');
                    document.body.style.overflow = 'auto';
                });
            });
        });
    </script>
    <script>
    function filterProducts() {
        const filterValue = document.getElementById('productFilter').value;
        const url = new URL(window.location.href);
        
        if (filterValue === 'all') {
            url.searchParams.delete('service_type');
        } else {
            url.searchParams.set('service_type', filterValue);
        }
        
        window.location.href = url.toString();
    }
    </script>
</body>
</html>